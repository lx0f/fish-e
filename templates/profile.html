{% from 'bootstrap5/form.html' import render_field %}
{% from 'macros/item_card.html' import item_card %}
{% from 'macros/navbar.html' import navbar %}
{% from 'macros/review_card.html' import review_card %}
{% extends 'base.html' %}
{% block title %}{{ user.username }}{% endblock title %}
{% block content %}
{{ navbar(search_form, current_user) }}
<style>
    .card {
        margin: 15px 10px 10px 10px;
    }

    #img1 {
        margin: 10px 10px 10px 10px;
    }
</style>

<div class="container">
    <div class="row mx-5">
        <div class="col-md-4">
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div id = "img1" class="card-title text-center">
                            <img src="{{ url_for('static', filename='img/profile/' + user.image_file) }}" alt="pfp"
                                class="rounded-circle">
                            <br>
                            {% if user == current_user %}
                            <a href="" data-bs-toggle="modal" data-bs-target="#pfpModal"><small>change</small></a>
                            {% endif %}
                        </div>
                        <div class="card-body text-center">
                            <strong>@{{ user.username }}</strong>
                            {% if user == current_user %}
                            <a href="" data-bs-toggle="modal" data-bs-target="#usernameModal"><small>change</small></a>
                            {% endif %}
                            <br>
                            <small>Joined on {{
                                user.date_joined.date()
                                }}</small>
                            <br>
                            <small>
                                {{ user.rating }} ({{ user.ratings }})
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-title text-center">
                            <strong>About Me</strong>
                            <br>
                            {% if user.description %}
                            <small>{{ user.description }}</small>
                            <br>
                            {% if user == current_user %}
                            <a href="" data-bs-toggle="modal"
                                data-bs-target="#descriptionModal"><small>change</small></a>
                            {% endif %}
                            {% else %}
                            {% if user == current_user %}
                            <a href="" data-bs-toggle="modal" data-bs-target="#descriptionModal"><small>add about
                                    me</small></a>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card" style="max-height: 80%;">
                <div class="card-title px-3">
                    <strong>Listings ({{ len_of_L_items }})</strong>
                </div>
                <div class="card-body overflow-scroll row">
                    {% if L_items %}
                    {% for item in L_items %}
                    <div class="col-md-4">
                        {{ item_card(item, current_user) }}
                    </div>
                    {% endfor %}
                    {% else %}
                    <u>No listed items yet</u>
                    <br>
                    {% if user == current_user %}
                    <a href="/item/add"><button class="btn btn-sm btn-primary">Click here to add an item</button></a>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="row mx-5">
        <div class="col">
            <div class="card">
                <div class="card-title">
                    <strong>Reviews</strong>
                </div>
                <div class="card-body">
                    {% for review in reviews %}
                    {{ review_card(review) }}
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>
</div>

<!-- ### ---------------- ### -->
<!-- ### ---------------- ### -->
<!-- ### ---- MODALS ---- ### -->
<!-- ### ---------------- ### -->
<!-- ### ---------------- ### -->

<!-- Profile Picture Form Modal -->
<form method="post" enctype="multipart/form-data">
    {{pfp_form.csrf_token() }}
    <div class="modal fade" id="pfpModal" tabindex="-1" aria-labelledby="pfpModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pfpModalLabel">Change profile picture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{ render_field(pfp_form.image_file) }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    {{ render_field(pfp_form.apply) }}
                </div>
            </div>
        </div>
    </div>
</form>

<!--  Username Form Modal -->
<form method="post">
    {{username_form.csrf_token() }}
    <div class="modal fade" id="usernameModal" tabindex="-1" aria-labelledby="usernameModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="usernameModalLabel">Change username</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{ render_field(username_form.username) }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    {{ render_field(username_form.apply) }}
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Description Form Modal -->
<form method="post">
    {{description_form.csrf_token() }}
    <div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptioinModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="descriptionModalLabel">Change description</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {{ render_field(description_form.description) }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    {{ render_field(description_form.apply) }}
                </div>
            </div>
        </div>
    </div>
</form>
{% endblock content %}